<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Hydra by flipkart-incubator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Hydra</h1>
      <h2 class="project-tagline">A JVM based DispatcherComposer Engine</h2>
      <a href="https://github.com/flipkart-incubator/hydra" class="btn">View on GitHub</a>
      <a href="https://github.com/flipkart-incubator/hydra/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/flipkart-incubator/hydra/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="hydra" class="anchor" href="#hydra" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hydra</h1>

<p>Hydra is a JVM based DispatcherComposer Engine.</p>

<p>Basically, you define the tasks to be performed and the input required for each of those tasks. From then on Hydra takes over - It creates the dependency graph, performs tasks in required order and composes the final output.</p>

<p>For each task to be performed, the input can be composed on any of the initial input parameters or output from already completed tasks. Same is the case with final response.</p>

<h2>
<a id="glossary" class="anchor" href="#glossary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Glossary</h2>

<h4>
<a id="dispatcher" class="anchor" href="#dispatcher" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>Dispatcher</code>
</h4>

<p><code>Dispatcher</code> is the top-level orchestrator. A Hydra <code>Dispatcher</code> execution comprises of -</p>

<ul>
<li>Already realized, initial map of parameters - <code>Map&lt;String, Object&gt;</code>
</li>
<li>An unordered map of <code>Task</code>s to be performed - <code>Map&lt;String, Task&gt;</code>
</li>
<li>A response curator - <code>Composer</code>
</li>
</ul>

<blockquote>
<p>Hydra provides a default implementation of <code>Dispatcher</code> (<code>DefaultDispatcher</code>) which can be initialized with or without a <code>Executor</code></p>

<p><code>DefaultDispatcher</code> allows for the use of a <code>Object</code> context (which is used to instantiate a <code>DefaultComposer</code> on the fly) as the response curator.</p>
</blockquote>

<h4>
<a id="task" class="anchor" href="#task" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>Task</code>
</h4>

<p>A <code>Task</code> is a combination of a <code>Composer</code> and a <code>Callable</code></p>

<ul>
<li>The <code>Composer</code> is the input curator for the <code>Callable</code>.</li>
<li>Output from <code>call()</code> of this <code>Callable</code> is the response of this <code>Task</code>.</li>
</ul>

<blockquote>
<p>Hydra provides a default implementation of <code>Task</code> (<code>DefaultTask</code>) which is initialized with -</p>

<ul>
<li>A <code>Callable</code> class that is instantiated on the fly. This class needs to have a single argument constructor which is used to instantiate it with a <code>Composer</code> output.</li>
<li>A <code>Composer</code> or a <code>Object</code> context (which is used to instantiate a <code>DefaultComposer</code> on the fly)</li>
</ul>
</blockquote>

<h4>
<a id="composer" class="anchor" href="#composer" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>Composer</code>
</h4>

<p>A <code>Composer</code> composes the given structure (<code>Map</code>, <code>List</code>, <code>String</code> or <code>Number</code>) based on previously realized values.</p>

<blockquote>
<p>Hydra provides a default implementation of <code>Composer</code> (<code>DefaultComposer</code>) which can take a nested collection and can extract out required dependencies and <code>Expression</code>s that need to be realized.</p>

<p><code>Expression</code>s to be parsed are represented by sandwiching a <code>String</code> between <code>{{</code> and <code>}}</code> and are converted to <code>DefaultExpression</code>.</p>

<h6>
<a id="examples--" class="anchor" href="#examples--" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples -</h6>

<ol>
<li><code>{{$someVar}}</code></li>
<li><code>{{$someMap.someKey}}</code></li>
</ol>
</blockquote>

<h4>
<a id="expression" class="anchor" href="#expression" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>Expression</code>
</h4>

<p>An <code>Expression</code> is a string representation of a data-path.</p>

<blockquote>
<p>Hydra provides a default implementation of <code>Expression</code> (<code>DefaultExpression</code>) which represents an expression as <code>String</code>.</p>

<p>Every variable in the expression starts with a <code>$</code>.</p>

<p>An <code>Expression</code> can be marked as optional by starting it with <code>#</code>. An optional expression means that <code>null</code> is a valid output. And an exception faced while realizing this expression will also respond back with <code>null</code>.</p>

<h6>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples:</h6>

<ol>
<li>
<code>someConstant</code> or <code>1.0</code> or <code>1</code> are static expressions with no variables</li>
<li>
<code>$someVar</code> is a variable expression that returns the value of <code>someVar</code>
</li>
<li>
<code>$someMap.someKey</code> is a variable expression that returns value of <code>someKey</code> from <code>someMap</code>
</li>
<li>
<code>$someMap.someKey[$someList[0]]</code> is a complex expression depending on more than 1 variable</li>
<li>
<code>#someMap.someKey</code> is an optional expression and will return <code>null</code> if <code>someMap</code> is <code>null</code> or if <code>someMap.someKey</code> is <code>null</code> or non-existent.</li>
</ol>
</blockquote>

<h2>
<a id="quick-usage" class="anchor" href="#quick-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick Usage</h2>

<p>Add following to <code>&lt;repositories/&gt;</code> section of pom.xml -</p>

<div class="highlight highlight-xml"><pre>&lt;<span class="pl-ent">repository</span>&gt;
  &lt;<span class="pl-ent">id</span>&gt;clojars&lt;/<span class="pl-ent">id</span>&gt;
  &lt;<span class="pl-ent">name</span>&gt;Clojars repository&lt;/<span class="pl-ent">name</span>&gt;
  &lt;<span class="pl-ent">url</span>&gt;https://clojars.org/repo&lt;/<span class="pl-ent">url</span>&gt;
&lt;/<span class="pl-ent">repository</span>&gt;</pre></div>

<p>Add following to <code>&lt;dependencies/&gt;</code> section of your pom.xml -</p>

<div class="highlight highlight-xml"><pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;com.flipkart.hydra&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;hydra-dispatcher&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;1.1&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre></div>

<p>You can now, call <code>Dispatcher</code> using following code</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// Already resolved list of parameters</span>
<span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Object</span>&gt;</span> initialParams <span class="pl-k">=</span> <span class="pl-c1">...</span>;

<span class="pl-c">// Map of tasks to be dispatched (mapped to the keys that will store the task response)</span>
<span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Task</span>&gt;</span> tasks <span class="pl-k">=</span> <span class="pl-c1">...</span>;

<span class="pl-c">// Final response that needs to be realized</span>
<span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Object</span>&gt;</span> response <span class="pl-k">=</span> <span class="pl-c1">...</span>;

<span class="pl-c">// Dispatcher Call</span>
<span class="pl-smi">Dispatcher</span> dispatcher <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultDispatcher</span>();
<span class="pl-smi">Object</span> output <span class="pl-k">=</span> dispatcher<span class="pl-k">.</span>execute(initialParams, tasks, response);</pre></div>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h2>

<h3>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span class="octicon octicon-link"></span></a>Description</h3>

<ul>
<li>We already have an Employee Name.</li>
<li>Assuming all employees have unique names, we want to fetch -

<ul>
<li>Employee ID (provided by EmployeeIdentificationService)</li>
<li>Employee Joining Date (provided by EmployeeInfoService)</li>
</ul>
</li>
<li>Now using Employee ID, we want to fetch -

<ul>
<li>His department (provided by EmployeeDepartmentService)</li>
<li>His salary (provided by EmployeeSalaryService)

<ul>
<li>This information might be confidential and hence can throw UnauthorizedException</li>
<li>We don't want to fail in this case</li>
</ul>
</li>
<li>His city (provided as part of response by EmployeeLocationService)</li>
<li>His complete address (provided as part of response by EmployeeLocationService)</li>
<li>Lat/Lng of all components of his address</li>
</ul>
</li>
<li>Now we want to respond back with all this information</li>
</ul>

<h3>
<a id="steps" class="anchor" href="#steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Steps</h3>

<h5>
<a id="create-the-initial-set-of-parameters--" class="anchor" href="#create-the-initial-set-of-parameters--" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create the initial set of parameters -</h5>

<div class="highlight highlight-java"><pre><span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Object</span>&gt;</span> initialParams <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">HashMap&lt;&gt;</span>();
initialParams<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>employeeName<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>John Doe<span class="pl-pds">"</span></span>);</pre></div>

<h5>
<a id="create-a-list-of-tasks-to-be-performed--" class="anchor" href="#create-a-list-of-tasks-to-be-performed--" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a list of <code>Task</code>s to be performed -</h5>

<h6>
<a id="task-1---fetching-employeeid-from-employeename" class="anchor" href="#task-1---fetching-employeeid-from-employeename" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 1 - Fetching <code>employeeID</code> from <code>employeeName</code>
</h6>

<div class="highlight highlight-java"><pre><span class="pl-smi">Expression</span> expression1 <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultExpression</span>(<span class="pl-s"><span class="pl-pds">"</span>{{$employeeName}}<span class="pl-pds">"</span></span>);
<span class="pl-smi">Composer</span> composer1 <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultComposer</span>(expression1, <span class="pl-c1">true</span>);
<span class="pl-smi">Task</span> employeeIDTask <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultTask</span>(<span class="pl-smi">EmployeeIdentificationService</span><span class="pl-k">.</span>class, composer1);</pre></div>

<h6>
<a id="task-2---fetching-joiningdate-from-employeename" class="anchor" href="#task-2---fetching-joiningdate-from-employeename" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 2 - Fetching <code>joiningDate</code> from <code>employeeName</code>
</h6>

<div class="highlight highlight-java"><pre><span class="pl-c">// Short notation for creating expression on the fly</span>
<span class="pl-smi">Composer</span> composer2 <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultComposer</span>(<span class="pl-s"><span class="pl-pds">"</span>{{$employeeName}}<span class="pl-pds">"</span></span>);
<span class="pl-smi">Task</span> joiningDateTask <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultTask</span>(<span class="pl-smi">EmployeeInfoService</span><span class="pl-k">.</span>class, composer2);</pre></div>

<h6>
<a id="task-3---fetching-department-from-employeeid" class="anchor" href="#task-3---fetching-department-from-employeeid" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 3 - Fetching <code>department</code> from <code>employeeID</code>
</h6>

<div class="highlight highlight-java"><pre><span class="pl-c">// Short notation for creating composer on the fly</span>
<span class="pl-smi">Task</span> departmentTask <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultTask</span>(<span class="pl-smi">EmployeeDepartmentService</span><span class="pl-k">.</span>class, <span class="pl-s"><span class="pl-pds">"</span>{{$employeeID}}<span class="pl-pds">"</span></span>);</pre></div>

<h6>
<a id="task-4---fetching-salary-from-employeeid" class="anchor" href="#task-4---fetching-salary-from-employeeid" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 4 - Fetching <code>salary</code> from <code>employeeID</code>
</h6>

<div class="highlight highlight-java"><pre><span class="pl-smi">Task</span> salaryTask <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultTask</span>(<span class="pl-smi">EmployeeSalaryService</span><span class="pl-k">.</span>class, <span class="pl-s"><span class="pl-pds">"</span>{{$employeeID}}<span class="pl-pds">"</span></span>);</pre></div>

<h6>
<a id="task-5---fetching-location-from-employeename" class="anchor" href="#task-5---fetching-location-from-employeename" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 5 - Fetching <code>location</code> from <code>employeeName</code>
</h6>

<div class="highlight highlight-java"><pre><span class="pl-smi">Task</span> locationTask <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultTask</span>(<span class="pl-smi">EmployeeLocationService</span><span class="pl-k">.</span>class, <span class="pl-s"><span class="pl-pds">"</span>{{$employeeName}}<span class="pl-pds">"</span></span>);</pre></div>

<h6>
<a id="task-6---fetching-latlng-for-all-components-of-location" class="anchor" href="#task-6---fetching-latlng-for-all-components-of-location" aria-hidden="true"><span class="octicon octicon-link"></span></a>Task 6 - Fetching <code>latlng</code> for all components of <code>location</code>
</h6>

<div class="highlight highlight-java"><pre><span class="pl-c">// MultiTask for executing callable once for each value of the provided looping composer</span>
<span class="pl-c">// Composer can use $__key and $__value while iterating</span>
<span class="pl-c">// We also need to provide a ExecutorService to MultiTask</span>
<span class="pl-smi">Task</span> latLngTask <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultMultiTask</span>(executor, <span class="pl-smi">LatLngService</span><span class="pl-k">.</span>class, <span class="pl-s"><span class="pl-pds">"</span>{{$location}}<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>{{$__value}}<span class="pl-pds">"</span></span>);</pre></div>

<p>Finally collecting all <code>Task</code>s in a <code>Map</code></p>

<div class="highlight highlight-java"><pre><span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Task</span>&gt;</span> tasks <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">HashMap&lt;&gt;</span>();
tasks<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>joiningDate<span class="pl-pds">"</span></span>, joiningDateTask);
tasks<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>salary<span class="pl-pds">"</span></span>, salaryTask);
tasks<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>department<span class="pl-pds">"</span></span>, departmentTask);
tasks<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>employeeID<span class="pl-pds">"</span></span>, employeeIDTask);
tasks<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>location<span class="pl-pds">"</span></span>, locationTask);
tasks<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>latlng<span class="pl-pds">"</span></span>, latLngTask);</pre></div>

<h5>
<a id="create-the-response-curator" class="anchor" href="#create-the-response-curator" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create the response curator</h5>

<div class="highlight highlight-java"><pre><span class="pl-k">Map&lt;<span class="pl-smi">String</span>, <span class="pl-smi">Object</span>&gt;</span> responseContext <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">HashMap&lt;&gt;</span>();
responseContext<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>employeeName<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>{{$employeeName}}<span class="pl-pds">"</span></span>);
responseContext<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>employeeID<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>{{$employeeID}}<span class="pl-pds">"</span></span>);
responseContext<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>department<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>{{$department}}<span class="pl-pds">"</span></span>);
responseContext<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>salary<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>{{#$salary}}<span class="pl-pds">"</span></span>); <span class="pl-c">// Optional data - will not fail on null value</span>
responseContext<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>{{$location.city}}<span class="pl-pds">"</span></span>); <span class="pl-c">// Using expressions to extract part of data</span>
responseContext<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>{{$(join, $(values, $location))}}<span class="pl-pds">"</span></span>); <span class="pl-c">// Using provided data access functions</span>
responseContext<span class="pl-k">.</span>put(<span class="pl-s"><span class="pl-pds">"</span>latlng<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>{{$latlng}}<span class="pl-pds">"</span></span>);</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-c">// This recursively iterates over the responseContext and parses any expression that it finds.</span>
<span class="pl-smi">Composer</span> response <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultComposer</span>(responseContext);</pre></div>

<h5>
<a id="create-a-executorservice" class="anchor" href="#create-a-executorservice" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a ExecutorService</h5>

<div class="highlight highlight-java"><pre><span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-smi">ExecutorService</span> executor <span class="pl-k">=</span> <span class="pl-smi">Executors</span><span class="pl-k">.</span>newCachedThreadPool();</pre></div>

<h5>
<a id="dispatch" class="anchor" href="#dispatch" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dispatch</h5>

<div class="highlight highlight-java"><pre><span class="pl-c">// Passing Optional Parameter (ExecutorService) so we can use the same for MultiTask</span>
<span class="pl-smi">Dispatcher</span> dispatcher <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultDispatcher</span>(executor);
<span class="pl-smi">Object</span> output <span class="pl-k">=</span> dispatcher<span class="pl-k">.</span>execute(initialParams, tasks, response);</pre></div>

<blockquote>
<p>Code for this example can be seen <a href="https://github.com/flipkart-incubator/hydra/blob/master/hydra-examples/src/main/java/com/flipkart/hydra/example/employee/EmployeeExample.java">here</a>.</p>
</blockquote>

<h2>
<a id="salient-points" class="anchor" href="#salient-points" aria-hidden="true"><span class="octicon octicon-link"></span></a>Salient Points</h2>

<ul>
<li>Easy to use interfaces</li>
<li>Auto creation/resolution of dependencies graph</li>
<li>Notation to express variables/expressions</li>
</ul>

<h2>
<a id="changes" class="anchor" href="#changes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Changes</h2>

<p>The change log can be found <a href="https://github.com/flipkart-incubator/hydra/blob/master/CHANGES.md">here</a></p>

<h2>
<a id="contribution-bugs-and-feedback" class="anchor" href="#contribution-bugs-and-feedback" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contribution, Bugs and Feedback</h2>

<p>For bugs, questions and discussions please use the <a href="https://github.com/flipkart-incubator/hydra/issues">Github Issues</a>.
Please follow the <a href="https://github.com/flipkart-incubator/hydra/blob/master/CONTRIBUTING.md">contribution guidelines</a> when submitting pull requests.</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>Copyright 2015 Flipkart Internet, pvt ltd.</p>

<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/flipkart-incubator/hydra">Hydra</a> is maintained by <a href="https://github.com/flipkart-incubator">flipkart-incubator</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

